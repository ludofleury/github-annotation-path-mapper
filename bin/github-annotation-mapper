#!/usr/bin/env php
<?php

$input = stream_get_contents(STDIN);

if ($argc > 3 || $argc < 2) {
    throw new \RuntimeException('Invalid arguments/options');
}

$options = getopt('s', ['silent']);
$silent = isset($options['s']) || isset($options['silent']);
$prefix = null;

if ($silent && $argc !== 3) {
    throw new \RuntimeException('Invalid arguments/options');
}

if (!$silent && $argc !== 2) {
    throw new \RuntimeException('Invalid arguments/options');
}

$arguments = $argv;
unset($arguments[0]);

foreach ($arguments as $arg) {
    if ($arg !== 's' && $arg !== 'silent') {
        $prefix = $arg;
    }
}

if ($prefix === null) {
    throw new \RuntimeException('Prefix is mandatory');
}

if ($input === false) {
    exit(2);
}

$count = 0;
echo str_replace('file=', 'file=' . $prefix, $input, $count);

$count > 0 ? ($silent ? exit(0) : exit(2)) : exit(0);
